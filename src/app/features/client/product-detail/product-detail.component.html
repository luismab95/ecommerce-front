<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    @if (loading()) {
    <app-loading />
    } @else if (product()) {
    <div class="bg-surface rounded-2xl border border-border overflow-hidden shadow-sm">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-0 lg:gap-8">
            <!-- Product Images -->
            <div class="p-8 bg-surface-subtle flex flex-col items-center justify-center">
                <div class="aspect-square w-full max-w-md bg-white rounded-xl overflow-hidden shadow-md mb-4 relative cursor-zoom-in"
                    (mousemove)="onMouseMove($event)" (mouseleave)="onMouseLeave()">
                    @if (selectedImage()) {
                    <img [src]="selectedImage()" [alt]="product()?.name"
                        class="w-full h-full object-contain transition-transform duration-200 ease-out"
                        [style.transform-origin]="zoomPosition().x + '% ' + zoomPosition().y + '%'"
                        [style.transform]="isZoomed() ? 'scale(2)' : 'scale(1)'" />
                    } @else {
                    <div class="w-full h-full flex items-center justify-center text-text-muted">
                        <span class="text-6xl opacity-20">üì∑</span>
                    </div>
                    }
                </div>

                <!-- Thumbnails -->
                @if (product()?.images?.length ?? 0 > 1) {
                <div class="flex space-x-4 overflow-x-auto py-2 max-w-full">
                    @for (image of product()?.images; track image.id) {
                    <button (click)="selectImage(image.path)"
                        class="w-20 h-20 rounded-lg border-2 overflow-hidden transition-all"
                        [class.border-primary]="selectedImage() === image.path"
                        [class.border-transparent]="selectedImage() !== image.path">
                        <img [src]="image.path" [alt]="product()?.name" class="w-full h-full object-cover" />
                    </button>
                    }
                </div>
                }
            </div>

            <!-- Product Details -->
            <div class="p-8 lg:p-12 flex flex-col">
                <div class="mb-auto">
                    <div class="flex items-center justify-between mb-4">
                        @if (product()?.featured) {
                        <span
                            class="px-3 py-1 bg-accent/10 text-accent text-sm font-bold uppercase tracking-wider rounded-full">
                            Destacado
                        </span>
                        }
                        <span class="text-sm text-text-muted">ID: {{ product()?.id }}</span>
                    </div>

                    <h1 class="text-4xl font-bold text-text-main mb-4">{{ product()?.name }}</h1>

                    <div class="flex items-baseline gap-4 mb-6">
                        <span class="text-3xl font-bold text-primary">\${{ product()?.price?.toFixed(2) }}</span>
                        @if (product()?.stock ?? 0 > 0) {
                        <span class="text-sm text-green-600 font-medium bg-green-100 px-2 py-1 rounded-full">
                            Disponible ({{ product()?.stock }})
                        </span>
                        } @else {
                        <span class="text-sm text-red-600 font-medium bg-red-100 px-2 py-1 rounded-full">
                            Agotado
                        </span>
                        }
                    </div>

                    <p class="text-text-muted text-lg leading-relaxed mb-8">
                        {{ product()?.description }}
                    </p>

                    <div class="border-t border-border pt-6 mb-8">
                        <h3 class="text-sm font-semibold text-text-main uppercase tracking-wider mb-3">Caracter√≠sticas
                        </h3>
                        <ul class="space-y-2 text-text-muted">
                            <li class="flex items-center gap-2">
                                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M5 13l4 4L19 7" />
                                </svg>
                                Env√≠o gratis disponible
                            </li>
                            <li class="flex items-center gap-2">
                                <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Garant√≠a de 2 a√±os
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row gap-4 mt-8">
                    <button (click)="addToCart()" [disabled]="(product()?.stock ?? 0) === 0"
                        class="flex-1 px-8 py-4 bg-primary text-white text-lg font-bold rounded-xl hover:bg-primary/90 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-primary/30 flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        A√±adir al Carrito
                    </button>
                    <a routerLink="/products"
                        class="px-8 py-4 bg-surface border border-border text-text-main text-lg font-bold rounded-xl hover:bg-surface-subtle transition-all flex items-center justify-center">
                        Volver al Cat√°logo
                    </a>
                </div>
            </div>
        </div>
    </div>
    } @else {
    <div class="text-center py-20">
        <div class="text-6xl mb-4">üòï</div>
        <h2 class="text-2xl font-bold text-text-main mb-2">Producto no encontrado</h2>
        <p class="text-text-muted mb-8">El producto que buscas no existe o ha sido eliminado.</p>
        <a routerLink="/products"
            class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors">
            Volver al Cat√°logo
        </a>
    </div>
    }
</div>